//
//  LearnSwfit
//  Created by Ht.
//  Copyright Â© 2019 Ht. All rights reserved.
//

import UIKit

// é—­åŒ…ã€‚é—­åŒ…åˆå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªå‡½æ•°ä½“ï¼Œå®ƒåƒå‡½æ•°ä¸€æ ·å¯ä»¥ä¼ å‚ï¼Œå¯ä»¥æœ‰è¿”å›å€¼ã€‚åªæ˜¯å£°æ˜æ–¹å¼å’Œè°ƒç”¨æ–¹å¼è·Ÿå‡½æ•°funcä¸åŒã€‚
// æ— å‚ã€æ— è¿”å›å€¼:
var closure1: () -> Void = {
    
}

// æ— å‚ã€æœ‰è¿”å›å€¼:
var closure2: () -> String = {
    return "closure2"
}
// å¯ç®€å†™ä¸º:        // å½“é—­åŒ…ä¸­åªåŒ…å«ä¸€å¥ return ä»£ç æ—¶ï¼Œå¯ä»¥çœç•¥returnå…³é”®å­—
closure2 = { "closure2" }
print(closure2())       // è¾“å‡º "closure2"

// æœ‰å‚ã€æœ‰è¿”å›å€¼çš„å†™æ³•ä¸€:
//var closure3: (_ pram1: String, _ pram2: Int) -> String
// å‚æ•°åå¯ä»¥çœç•¥ä¸å†™ï¼Œä¸€å®šè¦å†™å‚æ•°åçš„è¯è¦åœ¨å‚æ•°åå‰åŠ ä¸‹åˆ’çº¿
var closure3: (String, Int) -> String
closure3 = {            // ç±»å‹è‡ªåŠ¨æ¨å¯¼ã€‚æ‰€ä»¥pram å¯¹åº”Stringï¼Œpram1å¯¹åº” Int
    pram1, pram2 in
    if pram2 == 1 {
        return "\(pram1) ht"
    } else {
        return "\(pram1) other"
    }
}
// è°ƒç”¨
closure3("I am", 1)         // "I am ht"
// closure3çš„å†™æ³•äºŒ:
closure3 = {
    // $ç¾å…ƒç¬¦åŠ æ•°å­—å¯ç”¨åœ¨é—­åŒ…ä¸­ï¼Œæ ¹æ®ä¸‹æ ‡è‡ªåŠ¨æ¨å¯¼ä¸ºé—­åŒ…ä¸­ç›¸åº”çš„å‚æ•°ã€‚ä»0å¼€å§‹ä¸€ä¸€å¯¹åº”
    if $1 == 1 {
        return "\($0) ht"
    } else {
        return "\($0) other"
    }
}
closure3("I am", 0)
// å†™æ³•ä¸‰:
// å½“é—­åŒ…ä¸­åªåŒ…å«ä¸€å¥ return ä»£ç æ—¶ï¼Œå¯ä»¥çœç•¥returnå…³é”®å­—
closure3 = { $1 == 1 ? "\($0) ht" : "\($0) other" }
closure3("I am", 0)
// è®¡ç®—ä¸¤ä¸ªæ•´æ•°çš„ä¹˜ç§¯
var testClos: (Int, Int) -> Int = { return $0 * $1 }
testClos(2, 5)          // 10
testClos = { $0 * $1 }          // è¿™æ˜¯é—­åŒ…æœ€ç®€æ´çš„å†™æ³•ã€‚ä½¿ç”¨$ç¬¦æ•è·å‚æ•°ã€çœç•¥æ‰return
testClos(3, 5)          // 15

/*********** åˆ†å‰²çº¿ ***********/
// é—­åŒ…èƒ½å¤Ÿä»ä¸Šä¸‹æ–‡ä¸­æ•è·å˜é‡ã€å¸¸é‡ï¼Œä»è€Œç”¨åœ¨è‡ªèº«çš„ä½œç”¨åŸŸä¸­ã€‚
// eg:
var num = 1
let changeNumClosure = {
    num += 1
}
changeNumClosure()
print("æ”¹å˜åçš„num: \(num)")

/*********** åˆ†å‰²çº¿ ***********/
// ä½¿ç”¨é—­åŒ…ä½œä¸ºå‡½æ•°å‚æ•°ã€‚æ³¨æ„()çš„èŒƒå›´ï¼Œåˆ«çœ‹æ‡µäº†
func closureTest(num: Int, closure: (String, Int) -> String) -> String {
    return closure("I am", num)
}
// ä¼ å…¥ä¹‹å‰å®šä¹‰å¥½çš„é—­åŒ…
closureTest(num: 1, closure: closure3)   // I am ht
//closureTest(num: 1) { (<#String#>, <#Int#>) -> String in
//    <#code#>
////}
// è‡ªå®šä¹‰é—­åŒ…å†…éƒ¨çš„å®ç°ã€‚ä¸‹é¢ğŸ‘‡æ˜¯è‡ªå®šä¹‰é—­åŒ…å®ç°çš„ç®€åŒ–å†™æ³•ã€‚
// å½“é—­åŒ…ä½œä¸ºå‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°æ—¶ï¼Œå¯ä»¥å°†é—­åŒ…åç½®åˆ°å‡½æ•°ä½“å¤–éƒ¨ï¼Œä¹Ÿå¯ä»¥æ”¾åœ¨å‡½æ•°ä½“å†…éƒ¨ã€‚è¿™ä¹Ÿå«åšå°¾éšé—­åŒ…
closureTest(num: 1, closure: { $1 == 0 ? "I am ht" : "I am other" })    // I am other
closureTest(num: 1) { $1 == 0 ? "I am ht" : "I am other" }   // I am other

/*********** åˆ†å‰²çº¿ ***********/
// ä¸Šé¢è¯´åˆ°å°¾éšé—­åŒ…ã€‚ä¸‹é¢ä¸ºå¤§å®¶ä»‹ç»é€ƒé€¸é—­åŒ…: é€ƒé€¸é—­åŒ…ã€éé€ƒé€¸é—­åŒ…
// åœ¨Swift 3.0ä»¥åï¼Œå°†é—­åŒ…ä¼ é€’åˆ°å‡½æ•°ä¸­æ—¶ï¼Œç³»ç»Ÿä¼šå°†å…¶é»˜è®¤ä¸ºéé€ƒé€¸é—­åŒ…@noescape
// é€ƒé€¸é—­åŒ…è¦åœ¨é—­åŒ…å‰åŠ ä¸Š@escaping å…³é”®å­—

// éé€ƒé€¸é—­åŒ…çš„ç”Ÿå‘½å‘¨æœŸä¸å‡½æ•°ç›¸åŒ: 1ã€é—­åŒ…ä½œä¸ºå‚æ•°ä¼ å…¥å‡½æ•°ï¼Œ2ã€å‡½æ•°ä¸­è°ƒç”¨é—­åŒ…ï¼Œ3ã€å‡½æ•°é€€å‡ºï¼Œé—­åŒ…å£°æ˜å‘¨æœŸç»“æŸ
// é€ƒé€¸é—­åŒ…çš„ç”Ÿå‘½å‘¨æœŸæ¯”å‡½æ•°é•¿ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥é—­åŒ…ä¼šâ€œé€ƒé€¸â€å‡ºå‡½æ•°çš„ä½œç”¨åŸŸï¼Œæ‰€ä»¥å³ä½¿é€€å‡ºäº†å‡½æ•°å®ƒä¾ç„¶èƒ½è¢«æ‰§è¡Œè°ƒç”¨ã€‚: 1ã€é—­åŒ…ä½œä¸ºå‚æ•°ä¼ å…¥å‡½æ•°ï¼Œ2ã€å‡½æ•°é€€å‡ºï¼Œ3ã€é—­åŒ…è¢«è°ƒç”¨ï¼Œå£°æ˜å‘¨æœŸç»“æŸ
// ä¸Šé¢çš„closureTestä¸­çš„closureé—­åŒ…å‚æ•°å±äºéé€ƒé€¸é—­åŒ…, å³å‡½æ•°é€€å‡ºï¼Œé—­åŒ…ç”Ÿå‘½å‘¨æœŸç»“æŸ
// é€ƒé€¸é—­åŒ…ï¼Œeg:  å¦‚æœä¸åŠ @escapingå…³é”®å­—ä¼šç¼–è¯‘å‡ºé”™
func escapingClos(closure:@escaping (Int) -> Int) {
    DispatchQueue.global().async {      // åœ¨globalé˜Ÿåˆ—ä¸­å¼‚æ­¥æäº¤ä¸€ä¸ªä»»åŠ¡
        DispatchQueue.main.async {     // åœ¨ä¸»çº¿ç¨‹ä¸­é˜Ÿåˆ—ä¸­å¼‚æ­¥æäº¤ä¸€ä¸ªä»»åŠ¡
            print(closure(1))
        }
    }
}
escapingClos(closure: { $0 })

/*********** åˆ†å‰²çº¿ ***********/
// ç»å¸¸ä½¿ç”¨é€ƒé€¸é—­åŒ…çš„åœºæ™¯æœ‰:
// 1ã€åœ¨çº¿ç¨‹é˜Ÿåˆ—ä¸­å¼‚æ­¥è°ƒç”¨é—­åŒ…ï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚æˆåŠŸ or å¤±è´¥çš„å›è°ƒã€‚è¿™ä¸ªé˜Ÿåˆ—ä¼šæŒæœ‰é—­åŒ…çš„å¼•ç”¨ï¼Œç›´åˆ°è¯·æ±‚æˆåŠŸ or å¤±è´¥
// 2ã€å­˜å‚¨é—­åŒ…ä½œä¸ºå±æ€§ã€å…¨å±€å˜é‡ä½œç¨åä½¿ç”¨ã€‚eg:
var arr: [(String) -> Void] = []
func escapingBlock(closure: @escaping (String) -> Void) {
    arr.append(closure)     // å°†é—­åŒ…å­˜å‚¨åˆ°arrå±æ€§ä¸­ï¼Œç”¨äºé€ƒé€¸è°ƒç”¨
}
escapingBlock(closure: { print($0) })
escapingBlock(closure: { print("\($0) world") })
// éå†è£…æœ‰é—­åŒ…çš„æ•°ç»„ï¼Œå³ä½¿escapingBlockå·²ç»æ‰§è¡Œå®Œæˆï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥åœ¨æ­¤å¤„è°ƒç”¨åˆšæ‰ä¼ å…¥çš„ä¸¤ä¸ªé—­åŒ…
for clos in arr {
    clos("hello")
}
